<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Video Projector</title>
        <meta charset="utf-8">
    <title>Hello, WebVR! â€¢ A-Frame</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>

    <!-- Components and shaders go after A-Frame, but before the scene declaration. -->
    <script>
    AFRAME.registerShader('my-custom', {
      // The schema declares any parameters for the shader.
      schema: {
        // Where relevant, it is customary to support color.
        // The A-Frame schema uses `type:'color'`, so it will parse string values like 'white' or 'red.
        // `is:'uniform'` tells A-Frame this should appear as uniform value in the shader(s).
        color: {type:'color', is:'uniform', default:'red'},
        // It is customary to support opacity, for fading in and out.
        opacity: {type:'number', is:'uniform', default:1.0}
      },
      
      // Setting raw to true uses THREE.RawShaderMaterial instead of ShaderMaterial,
      // so your shader strings are used as-is, for advanced shader usage.
      // Here, we want the usual prefixes with GLSL constants etc.,
      // so we set it to false.
      // (Which is also the default, so we could have omitted it).
      raw: false,
      
      // Here, we're going to use the default vertex shader by omitting vertexShader.
      // But note that if your fragment shader cares about texture coordinates,
      // the vertex shader should set varying values to use in the fragment shader. 
      
      // Since almost every WebVR-capable browser supports ES6,
      // define our fragment shader as a multi-line string.
      fragmentShader: 
    `
      // Use medium precision.
      precision mediump float;

      // This receives the color value from the schema, which becomes a vec3 in the shader.
      uniform vec3 color;

      // This receives the opacity value from the schema, which becomes a number.
      uniform float opacity;

      // This is the shader program.
      // A fragment shader can set the color via gl_FragColor,
      // or decline to draw anything via discard.
      void main () {
        // Note that this shader doesn't use texture coordinates.
        // Set the RGB portion to our color,
        // and the alpha portion to our opacity.
        gl_FragColor = vec4(color, opacity);
      }
    `
    });
    </script>

    <style type="text/css">
      #video-permission {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: white;
          z-index: 10000;
          display: none;
      }

      #video-permission-button {
        position: fixed;
        top: calc(50% - 1em);
        left: calc(50% - 60px);
        width: 120px;
        height: 2em;
      }
    </style>

  </head>
  <body>

    <div id="video-permission">
      <button id="video-permission-button">Allow VR video</button>
    </div>

    <a-scene fog="type: linear; near:1; far:50; color: #1F1F1F;"><!--Night mode: #0c192a-->


      <a-assets>
        <img src="assets/white_grid_thin.png" id="grid" crossorigin="anonymous">
        <video id="video-src" autoplay loop="true" src="assets/interstellar.mp4"></video>
        <a-asset-item id="cinema" src="assets/cinema.glb"></a-asset-item>
      </a-assets>


      <!-- VR CONTROLLERS -->
      <a-entity oculus-touch-controls="hand: left"></a-entity>
      <a-entity oculus-touch-controls="hand: right"></a-entity>
      <!-- END VR CONTROLLERS -->

      <!-- MEDIAS HOLDER -->
      <a-video id="video-screen" src="#video-src" position="0 4.5 -14" width="16" height="9"></a-video>
      <!-- END MEDIAS HOLDER -->


      <!-- ENVIRONMENT -->
      
      <a-box
          depth="28" height="10" width="20" position="0 5 0"
          material="shader:my-custom; color:blue; opacity:0.7; transparent:true"></a-box>

      <!--<a-entity
          geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0"
          material="src: #grid; repeat: 10000 10000; transparent: true; opacity:0.3;"></a-entity>-->

      <!--<a-sky color="#dbdedb"></a-sky>-->

      <!--<a-entity light="type: point; color: #133255; intensity: 0.75; distance: 50; decay: 2"
          position="0 4.5 -12"></a-entity> -->


      <!-- END ENVIRONMENT -->
    </a-scene>

  </body>
</html>
